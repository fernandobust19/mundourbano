<!DOCTYPE html> 
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>Mundo urbano ‚Äî Gobierno Central y Nuevos Edificios (Multiplayer)</title>
<link rel="stylesheet" href="css/public_css_estilos.css">
<!-- Fuente moderna para un texto m√°s bonito -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  @import "otra.css";
  :root { --color-principal: yellow; }
  body { background: var(--color-principal); }

  :root{
    /* Tema amarillo (variables ajustadas) */
    --bg:#ffd54f; /* fondo principal */
    --card:#fff8e1; /* tarjetas y modales */
    /* UI m√°s oscuro, azul-gris√°ceo con transparencia */
    --ui:#9aa7b3cc; /* elementos UI con transparencia (darker bluish-gray) */
    --edge:#d4a300; /* bordes/acento oscuro */
    --brand:#ff9800; /* color principal de botones */
    --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444; --muted:#8b6b00; --text:#222222;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#fff8e1);color:var(--text);font-family:'Poppins',system-ui,Segoe UI,Roboto,Arial;overflow:hidden;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
  html, body {-webkit-user-select: none; -ms-user-select: none; user-select: none;}
  *{box-sizing:border-box}


  /* Fondo del men√∫ de crear personaje: degradado morado oscuro como la referencia (sin l√≠neas) */
  #formBar{position:fixed;top:0;left:0;right:0;z-index:2000;
    background:
      radial-gradient(900px 520px at 18% 12%, rgba(150, 120, 255, 0.14), rgba(150,120,255,0) 52%),
      radial-gradient(800px 480px at 85% 18%, rgba(255, 170, 120, 0.10), rgba(255,170,120,0) 55%),
      radial-gradient(1200px 700px at 50% 100%, rgba(0,0,0,0.28), rgba(0,0,0,0) 60%),
      linear-gradient(180deg, #140c2a 0%, #2a0e55 52%, #190b42 100%);
    border-bottom:1px solid rgba(20,40,64,0.28);backdrop-filter:blur(6px);color:#eef7fb;max-height:100svh;overflow-y:auto}
  #formInner{width:min(1100px,98vw);margin:0 auto;padding:18px 14px 12px;display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
  #formBar{ font-size:13px }
  #formInner h2{grid-column:1/-1;margin:2px 0 6px 0;color:#ffd54a;font-size:20px;line-height:1.15;font-weight:800;text-shadow:0 1px 0 rgba(0,0,0,.25)}
  .field{display:flex;flex-direction:column;gap:6px}
  .field label{font-size:12px;color:#c9c2ff;opacity:.95}
  /* Inputs/selects oscuros con borde violeta y texto claro (como la referencia) */
  #formBar .input,#formBar .select{
    padding:12px 14px;
    border-radius:14px;
    border:2px solid rgba(128,90,213,0.55);
    background:
      linear-gradient(180deg, rgba(255,255,255,0.06), rgba(0,0,0,0.22));
    color:#eef1ff; font-size:13px;
    min-height:42px;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.12), 0 6px 18px rgba(0,0,0,0.20);
  }
  #formBar .input::placeholder{ color:#bdb7ff }
  #formBar .input:focus,#formBar .select:focus{ outline:2px solid rgba(147,197,253,0.7); outline-offset:2px }

  /* Botones estilo cartoon (como la imagen): borde blanco, gradiente vivo, sin glow */
  .btn{
    all:unset; cursor:pointer; display:inline-grid; place-items:center; text-align:center;
    padding:10px 18px; border-radius:18px; font-weight:800; letter-spacing:.3px; color:#ffffff;
    text-shadow: 0 2px 0 rgba(0,0,0,0.25);
    background: linear-gradient(180deg, #a855f7, #7e22ce); /* morado por defecto */
    border:4px solid #ffffff;
    box-shadow: 0 8px 16px rgba(0,0,0,0.25), 0 4px 0 rgba(0,0,0,0.18);
    transition: transform .08s ease, filter .12s ease;
  }
  .btn:hover{ filter: brightness(1.04) }
  .btn:active{ transform: translateY(2px); box-shadow: 0 6px 12px rgba(0,0,0,0.25), 0 3px 0 rgba(0,0,0,0.18) }
  .btn:focus{ outline:2px solid rgba(255,255,255,0.6); outline-offset:2px }

  /* Variantes vivas (sin brillos extra) */
  .btn.primary{ background: linear-gradient(180deg, #fb923c, #ea580c); } /* naranja */
  .btn.good{    background: linear-gradient(180deg, #34d399, #16a34a); } /* verde */
  .btn.warn{    background: linear-gradient(180deg, #facc15, #f59e0b); } /* amarillo/√°mbar */
  .btn.bad{     background: linear-gradient(180deg, #f87171, #dc2626); } /* rojo */

  /* Botones dentro del formulario (#formBar) con estilo de la referencia (p√≠ldora morada, sin borde blanco grueso) */
  #formBar .btn{
    padding:10px 16px; border-radius:16px; font-weight:700; letter-spacing:.2px;
    background: linear-gradient(180deg,#8b5cf6,#5b21b6);
    border:1px solid rgba(255,255,255,0.25);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.20), 0 6px 16px rgba(0,0,0,0.25);
    text-shadow:none;
  }
  #formBar .btn:hover{ filter:brightness(1.05) }
  #formBar .btn:active{ transform:translateY(1px) }
  /* Espec√≠ficos */
  #formBar #btnStart{ background:linear-gradient(180deg,#a78bfa,#6d28d9) }
  #formBar #btnRandLikes{ background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(0,0,0,0.20)); color:#e5e7eb }
  .hint{font-size:12px;opacity:.8}
  .err{color:#fecaca;font-size:12px;display:none}
  .col-3{grid-column:span 3}.col-4{grid-column:span 4}.col-6{grid-column:span 6}.col-12{grid-column:span 12}
  @media (max-width:960px){.col-3,.col-4,.col-6{grid-column:1/-1}}


  #likesWrap{
    display:grid;grid-template-columns:repeat(4,minmax(150px,1fr));gap:8px;max-height:260px;overflow:auto;padding:8px;
    border:1px solid rgba(255,255,255,0.10); border-radius:14px;
    background: linear-gradient(180deg, rgba(12,9,28,0.85), rgba(14,11,32,0.90));
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.05);
  }
  /* Scrollbar del contenedor de gustos (WebKit) */
  #likesWrap::-webkit-scrollbar{ width:10px }
  #likesWrap::-webkit-scrollbar-track{ background: rgba(255,255,255,0.08); border-radius:8px }
  #likesWrap::-webkit-scrollbar-thumb{ background: rgba(255,255,255,0.35); border-radius:8px; border:2px solid rgba(255,255,255,0.18) }
  @media (max-width:960px){#likesWrap{grid-template-columns:repeat(2,minmax(150px,1fr));max-height:280px}}
  .chip{
    display:flex;align-items:center;gap:8px;padding:7px 10px;
    border:1px solid rgba(255,255,255,0.18); border-radius:12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(0,0,0,0.18));
    font-size:13px; white-space:nowrap; color:#e9e6ff;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.10);
  }
  .chip:hover{ background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(0,0,0,0.20)) }
  /* Checkbox personalizado en chips */
  .chip input[type="checkbox"]{appearance:none;-webkit-appearance:none;display:inline-grid;place-items:center;width:16px;height:16px;border-radius:5px;background:#f2cfe6;border:0;box-shadow:inset 0 -1px 0 rgba(0,0,0,0.15), 0 1px 0 rgba(255,255,255,0.20)}
  .chip input[type="checkbox"]:checked{background:#3f2bbf}
  .chip input[type="checkbox"]:checked::after{content:"";width:9px;height:9px;display:block;background-repeat:no-repeat;background-position:center;background-size:100%;
    background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='white'><path d='M7.5 13.5 4.5 10.5 3 12l4.5 4.5L17 7.5 15.5 6z'/></svg>");}
  .chip.disabled{opacity:.45;filter:grayscale(40%)}
  .chip.disabled input{pointer-events:none}
  .limitNote{font-size:11px;margin-top:4px;color:#93c5fd}
  #formBar .hint{ font-size:11px }
  /* Estado seleccionado (si el navegador soporta :has): chip amarillo con texto oscuro */
  #likesWrap .chip:has(input:checked){
    background: linear-gradient(180deg, #ffd84d, #ffb822);
    color:#1a1835; border-color:rgba(255,255,255,0.70);
    box-shadow: 0 2px 0 rgba(0,0,0,0.18), inset 0 1px 0 rgba(255,255,255,0.25);
  }
  #likesWrap .chip:has(input:checked) input[type="checkbox"]{ background:#2b236c }

  /* Avatar grid for visual selection */
  #avatarGrid{display:flex;gap:8px;align-items:center}
  .avatar-option{width:48px;height:48px;padding:0;border-radius:8px;border:1px solid transparent;background:transparent;display:inline-grid;place-items:center;cursor:pointer}
  .avatar-option img{width:100%;height:100%;object-fit:cover;border-radius:8px;display:block}
  .avatar-option.selected{outline:2px solid rgba(100,160,220,0.85);box-shadow:0 4px 14px rgba(16,24,32,0.45)}

  /* Tarjeta oscura para el bloque de avatar y subir foto (primera columna) */
  #formInner .col-3:first-of-type{
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(0,0,0,0.28));
    border:1px solid rgba(255,255,255,0.10);
    border-radius:16px; padding:14px; box-shadow: inset 0 1px 0 rgba(255,255,255,0.08);
  }
  #fGenderPreview{ border:3px solid #ffe066 !important; width:56px !important; height:56px !important }


  /* Mostrar canvas principal por defecto (antes estaba oculto) */
  /* Usar svh para m√≥viles (evita barra de direcciones) con fallback a vh */
  #world{display:block;width:100vw;height:100svh;height:100vh;position:fixed;inset:0;z-index:1;touch-action:none}
  .card{
    background: var(--card);
    border:1px solid rgba(255,255,255,0.08);
    border-radius:14px; padding:10px 12px; position:relative;
    box-shadow: 0 12px 28px rgba(0,0,0,0.20), inset 0 1px 0 rgba(255,255,255,0.08);
    backdrop-filter: blur(6px);
  }
  /* UI menus shown inside the map: p√∫rpura transl√∫cido para alinear con formulario */
  #uiDock .card, #docDock .card, #govDock .card {
    background:
      linear-gradient(180deg, rgba(255,255,255,0.06), rgba(0,0,0,0.22)),
      rgba(22, 16, 40, 0.78);
    border-color: rgba(255,255,255,0.10);
    color: #e5e7eb;
    backdrop-filter: blur(8px);
  }
  #uiDock, #docDock, #govDock{position:fixed;top:calc(10px + env(safe-area-inset-top));z-index:24;display:none;width:min(270px,92vw);display:flex;flex-direction:column;gap:6px;pointer-events:auto}
  #uiDock{left:10px;font-size:11.5px}
  /* Transition para mostrar/ocultar con animaci√≥n (hacia la izquierda) */
  #uiDock{transition: transform 260ms ease, opacity 220ms ease; will-change: transform, opacity}
  .collapsed-left{transform: translateX(-120%); opacity: 0; pointer-events: none}
  #docDock{left:10px;}
  #marriedDock{position:fixed; top:10px; left:10px; z-index:24; width:min(340px,92vw); display:none; flex-direction:column; gap:10px; pointer-events:auto;}
  #govDock{left:10px;}
  /* Botones azules para contraer/expandir el UI */
  #uiHideBtn{position:absolute;right:8px;bottom:8px;top:auto;width:34px;height:34px;border-radius:999px;border:1px solid rgba(0,0,0,0.08);background:#1d4ed8;color:#fff;display:grid;place-items:center;cursor:pointer;box-shadow:0 6px 20px rgba(0,0,0,.06)}
  #uiHideBtn::before{content:"";width:100%;height:100%;display:block;background-repeat:no-repeat;background-position:center;background-size:56%;
    background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ffffff'><path d='M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z'/></svg>"); /* flecha ‚óÄ */}
  #uiShowBtn{position:fixed;left:12px;top:calc(10px + env(safe-area-inset-top));z-index:25;width:40px;height:40px;border-radius:999px;border:1px solid rgba(0,0,0,0.08);background:#1d4ed8;color:#fff;cursor:pointer;box-shadow:0 4px 20px rgba(0,0,0,.04);text-align:center;padding:0;display:none;display:grid;place-items:center}
  #uiShowBtn::before{content:"";width:100%;height:100%;display:block;background-repeat:no-repeat;background-position:center;background-size:56%;
    background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ffffff'><path d='M8.59 16.59 10 18l6-6-6-6-1.41 1.41L13.17 12z'/></svg>"); /* flecha ‚ñ∂ */}


  .actions{display:flex;gap:8px;flex-wrap:wrap}
  pre{white-space:pre-wrap;font-family:ui-monospace,monospace;font-size:7px;max-height:40vh;overflow:auto;margin:0}


  #zoomFab{position:fixed;right:12px;bottom:calc(12px + env(safe-area-inset-bottom));z-index:26;display:flex;flex-direction:column;gap:10px;pointer-events:auto}
  .fab{width:56px;height:56px;border-radius:50%;display:grid;place-items:center;background:var(--brand);border:1px solid rgba(0,0,0,0.06);box-shadow:0 8px 20px rgba(0,0,0,.06);font-size:22px;cursor:pointer;user-select:none;color:var(--text)}
  .fab:active{transform:scale(.96)}
  /* Bot√≥n flotante Seguir m√°s visible (violeta) */
  #followFab{position:fixed;left:12px;bottom:calc(12px + env(safe-area-inset-bottom));z-index:26;pointer-events:auto;background:linear-gradient(180deg,#8b5cf6,#5b21b6);border:1px solid rgba(255,255,255,0.28)}
  #followFab{width:52px;height:52px;border-radius:50%;display:grid;place-items:center;box-shadow:0 8px 16px rgba(0,0,0,0.20)}
  /* Icono de mira (crosshair) dibujado con SVG como background, sin texto */
  #followFab::before{content:"";display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:center;background-size:64%;
    background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100' stroke='%23ffffff' stroke-width='6' fill='none'><circle cx='50' cy='50' r='28'/><line x1='50' y1='10' x2='50' y2='32'/><line x1='50' y1='68' x2='50' y2='90'/><line x1='10' y1='50' x2='32' y2='50'/><line x1='68' y1='50' x2='90' y2='50'/></svg>");
  }
  /* Estado activo: verde para indicar seguimiento ON */
  #followFab.on{ background: var(--ok); border-color:#15803d; }
  @media (max-width:700px){ #followFab{ width:48px;height:48px } }
  
  #modal,#builderModal,#shopModal{position:fixed;inset:0;z-index:50;background:rgba(0,0,0,.35);display:none;align-items: flex-start;justify-content:center;padding-top: 5vh;}
  .modalBox{width:min(560px,94vw);background:var(--card);border:1px solid rgba(0,0,0,0.06);border-radius:14px;padding:14px}
  .modalBox h3{margin:0 0 8px 0}
  .modalBox h4{margin:8px 0 6px 0}


  .balance-amount { color: var(--ok); font-size: 1.2em; font-weight: bold; }
  /* (Actualizado) Compactar el men√∫ UI y aplicar estilo del formulario (transl√∫cido, p√∫rpura) */
  #uiDock{ width:min(270px,92vw); }
  #uiDock .card{ padding:6px 8px; border-radius:14px; }
  #uiDock h4{ font-size:12px; color:#e5e7eb }
  #uiDock .actions{ gap:5px; flex-wrap:wrap }
  /* Botones del UI estilo formulario (p√≠ldora morada, sin borde blanco grueso) */
  #uiDock .btn{
    padding:5px 9px; border-radius:12px; font-size:11px; min-height:24px; line-height:1.05;
    background: linear-gradient(180deg,#8b5cf6,#5b21b6);
    border:1px solid rgba(255,255,255,0.25); color:#fff;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.18), 0 5px 10px rgba(0,0,0,0.20);
    text-shadow:none;
  }
  #uiDock .btn:hover{ filter:brightness(1.05) }
  #uiDock .btn:active{ transform:translateY(1px) }
  /* Variantes coherentes */
  #uiDock .btn.good{ background: linear-gradient(180deg, #34d399, #16a34a); }
  #uiDock .btn.primary{ background: linear-gradient(180deg, #a78bfa, #6d28d9); }
  #uiDock .btn.bad{ background: linear-gradient(180deg, #f87171, #dc2626); }
  /* Inputs/select peque√±os con borde violeta */
  #uiDock .select, #uiDock .input{
    padding:5px 7px; border-radius:8px; font-size:11.5px; min-height:24px;
    border:2px solid rgba(128,90,213,0.55);
    background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(0,0,0,0.22));
    color:#eef1ff;
  }
  #uiDock #ownedShops{ margin-top:2px; font-size:11px }
  #uiDock #stats, #uiDock #userName{ font-size:11px }
  #uiDock #uiAvatar{ width:44px !important; height:44px !important }
  #uiDock pre{ font-size:11px }

  /* Reducir tama√±o de botones del men√∫ de crear personaje (solo dentro del formulario) */
  #formInner .btn{ padding:6px 10px; border-radius:8px; font-size:12px; min-height:30px; line-height:1.1 }
  /* (Removido) estilos del modal de contrase√±a */


  #shopList{display:grid;grid-template-columns:1fr;gap:8px;max-height:260px;overflow-y:auto;padding:8px;border:1px solid rgba(0,0,0,0.06);border-radius:10px;background:var(--card)}


  #mini{position:fixed;right:12px;top:calc(12px + env(safe-area-inset-top));z-index:22;display:block;width:200px;height:130px;border:1px solid rgba(0,0,0,0.06);border-radius:10px;background:var(--card);box-shadow:0 6px 22px rgba(0,0,0,.04);cursor:crosshair;pointer-events:auto}
  #mini canvas{width:100%;height:100%;display:block}
  #mini .hint{position:absolute;left:6px;bottom:4px;font-size:10px;opacity:.7}

  /* Bot√≥n Seguir: se usa el bot√≥n flotante en el mapa (no en el UI dock) */


  #toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;z-index:40;display:none;background:rgba(255,245,157,0.9);border:1px solid rgba(0,0,0,0.06);color:var(--text);padding:8px 12px;border-radius:10px;font-size:13px}
  /* Botones de salida/cerrar en rojo */
  /* #btnLogout hereda .btn.bad */
  #btnGovClose, #btnDocClose, #btnMarriedClose{all:unset;cursor:pointer;display:grid;place-items:center;width:30px;height:30px;border-radius:8px;background:var(--bad);color:#fff;font-weight:800;line-height:1;box-shadow:0 2px 8px rgba(0,0,0,.25)}
  #btnGovClose:hover, #btnDocClose:hover, #btnMarriedClose:hover{filter:brightness(1.05)}
  #btnGovClose:active, #btnDocClose:active, #btnMarriedClose:active{transform:scale(.96)}

  /* Paneles largos: limitar altura en m√≥viles y permitir scroll interno */
  #docDock .card, #govDock .card { max-height: 80svh; max-height: 80vh; overflow: auto; }

  /* Ajustes m√≥viles espec√≠ficos */
  @media (max-width: 700px){
    .fab{ width:48px; height:48px; font-size:20px }
    #uiDock{ width:94vw }
    #top-bar{ gap:8px }
    #mini{ width:150px; height:100px }
    .btn{ min-height:42px }
    #likesWrap{ grid-template-columns:repeat(2,minmax(120px,1fr)); }
  }
  @media (max-width: 480px){
  /* Mantener minimapa visible tambi√©n en pantallas peque√±as */
  #uiShowBtn{ width:44px; height:44px }
    #formInner{ gap:8px }
  }
</style>
<style>
  /* Mantener botones del UI m√°s bajos incluso en m√≥vil */
  #uiDock .btn{ min-height:26px !important; padding:4px 7px; font-size:10.5px }
  /* Reducir y mantener peque√±os los botones del men√∫ crear persona tambi√©n en m√≥vil */
  #formInner .btn{ min-height:30px !important; padding:6px 10px; font-size:12px }
  /* Aumentar tama√±o de letra para Documento y Casados */
  #docBody, #marriedList { font-size: 22px !important; line-height: 1.5; }

  /* ===== Login (s√≥lo este men√∫ vuelve a la apariencia anterior) ===== */
  #authModal .modalBox{
    background:#fff7e6; color:#1f2937;
    border:1px solid #eadfc8; border-radius:18px;
    box-shadow:0 14px 36px rgba(0,0,0,0.20);
  }
  #authModal h3{ color:#0f172a; font-weight:800 }
  #authModal .hint{ color:#6b7280 }
  #authModal .field label{ color:#8b5cf6; font-weight:600 }
  #authModal .input, #authModal .select{
    background:#ffffff; color:#111827; min-height:34px;
    border:1px solid #cbd5e1; border-radius:8px;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.8);
    padding:8px 10px;
  }
  #authModal .input:focus, #authModal .select:focus{ outline:2px solid #a78bfa; outline-offset:1px }
  /* Bot√≥n principal naranja */
  #authModal #btnAuthLogin, #authModal .loginOnly.btn{
    background:linear-gradient(180deg,#f59e0b,#ea580c);
    color:#fff; border:1px solid rgba(0,0,0,0.06);
    border-radius:16px; box-shadow:0 6px 12px rgba(0,0,0,0.20);
    text-shadow: none; padding:10px 18px;
  }
  /* Bot√≥n Registrar (cuando se muestra) estilo verde cl√°sico */
  #authModal #btnAuthRegister{
    background:linear-gradient(180deg,#22c55e,#16a34a);
    color:#fff; border:1px solid rgba(0,0,0,0.06);
    border-radius:16px; box-shadow:0 6px 12px rgba(0,0,0,0.20);
    text-shadow:none; padding:10px 18px;
  }
  /* Bot√≥n secundario con fondo claro y texto azul */
  #authModal #authToggle{
    background:#f3f4f6 !important; color:#2563eb !important;
    border:1px solid #e5e7eb !important; border-radius:16px;
    box-shadow:0 6px 12px rgba(0,0,0,0.12);
    padding:10px 16px;
  }
  /* Imagen de fondo clara con leve oscurecido (ya aplicado inline en JS) */
</style>
</head> 
<body>

<div id="formBar" role="dialog" aria-modal="true" style="display:none">
  <form id="formInner" autocomplete="off">
    <h2>Crear tu persona (24h = 1 a√±o ¬∑ fallece a los 90)</h2>
  <div class="field col-3">
  <!-- Mantener g√©nero oculto aqu√≠; se define en el registro y se prellena a M/F -->
  <input type="hidden" id="fGender" value="" />
      <div id="avatarGrid" style="margin-top:8px">
  <button type="button" class="avatar-option" data-src="assets/avatar1.png"><img src="assets/avatar1.png" alt="H1"/></button>
  <button type="button" class="avatar-option" data-src="assets/avatar2.png"><img src="assets/avatar2.png" alt="H2"/></button>
  <button type="button" class="avatar-option" data-src="assets/avatar3.png"><img src="assets/avatar3.png" alt="F1"/></button>
  <button type="button" class="avatar-option" data-src="assets/avatar4.png"><img src="assets/avatar4.png" alt="F2"/></button>
      </div>
  <div style="margin-top:8px;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <input id="avatarFile" type="file" accept="image/*" style="display:none" />
  <button id="btnUploadAvatar" type="button" class="btn" style="background:linear-gradient(180deg,#a78bfa,#6d28d9);border-color:#fff">Subir foto</button>
  <button id="btnRemoveAvatar" type="button" class="btn" style="background:linear-gradient(180deg,#6b7280,#374151);border-color:#fff">Quitar foto</button>
  <img id="fGenderPreview" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='128' height='128'><rect width='100%' height='100%' fill='white'/><text x='50%' y='52%' text-anchor='middle' dominant-baseline='middle' font-size='84' font-family='Segoe UI, Arial, sans-serif' fill='%239ca3af'>?</text></svg>" alt="Vista previa" style="width:48px;height:48px;border-radius:50%;border:1px solid #2b3553;background:#fff;object-fit:cover" />
    <span class="hint" style="color:#c9c2ff">Puedes subir una foto para usarla como avatar. Se mostrar√° en el panel y en tu agente.</span>
      </div>
    </div>
  <div class="field col-3"><label>Nombre</label><input id="fName" type="text" maxlength="12" class="input" placeholder="nombre de usuario" autocomplete="username"/></div>
  <div class="field col-3"><label>Edad</label><input id="fAge" type="number" min="20" max="89" value="20" step="1" class="input"/></div>
  <div class="field col-3">
    <div style="display:flex;flex-direction:column;gap:10px;align-items:stretch">
      <!-- Campo oculto para compatibilidad con la l√≥gica existente -->
    <input id="fUsd" type="hidden" value="0" />
  <button id="btnBuy500" type="button" class="btn good" title="Pagar US$5 para obtener +500 cr√©ditos">Comprar 500 (+US$5)</button>
    </div>
  <div class="hint">Comienzas con 400 cr√©ditos gratis. Puedes comprar cr√©ditos cuando quieras para construir, abrir negocios y avanzar m√°s r√°pido en el mundo (+500 por compra).</div>
  </div>
    <div class="field col-12">
  <label style="color:#c9c2ff">Elige exactamente 5 gustos</label>
      <div id="likesWrap" aria-label="Lista de gustos">
        <label class="chip"><input type="checkbox" value="m√∫sica"><span>m√∫sica</span></label>
        <label class="chip"><input type="checkbox" value="arte"><span>arte</span></label>
        <label class="chip"><input type="checkbox" value="deporte"><span>deporte</span></label>
        <label class="chip"><input type="checkbox" value="naturaleza"><span>naturaleza</span></label>
        <label class="chip"><input type="checkbox" value="lectura"><span>lectura</span></label>
        <label class="chip"><input type="checkbox" value="cocina"><span>cocina</span></label>
        <label class="chip"><input type="checkbox" value="baile"><span>baile</span></label>
        <label class="chip"><input type="checkbox" value="tecnolog√≠a"><span>tecnolog√≠a</span></label>
        <label class="chip"><input type="checkbox" value="cine"><span>cine</span></label>
        <label class="chip"><input type="checkbox" value="viajes"><span>viajes</span></label>
        <label class="chip"><input type="checkbox" value="jardiner√≠a"><span>jardiner√≠a</span></label>
        <label class="chip"><input type="checkbox" value="fotograf√≠a"><span>fotograf√≠a</span></label>
        <label class="chip"><input type="checkbox" value="animales"><span>animales</span></label>
        <label class="chip"><input type="checkbox" value="playa"><span>playa</span></label>
        <label class="chip"><input type="checkbox" value="monta√±a"><span>monta√±a</span></label>
        <label class="chip"><input type="checkbox" value="videojuegos"><span>videojuegos</span></label>
        <label class="chip"><input type="checkbox" value="yoga"><span>yoga</span></label>
        <label class="chip"><input type="checkbox" value="meditaci√≥n"><span>meditaci√≥n</span></label>
        <label class="chip"><input type="checkbox" value="correr"><span>correr</span></label>
        <label class="chip"><input type="checkbox" value="ciclismo"><span>ciclismo</span></label>
        <label class="chip"><input type="checkbox" value="f√∫tbol"><span>f√∫tbol</span></label>
        <label class="chip"><input type="checkbox" value="baloncesto"><span>baloncesto</span></label>
        <label class="chip"><input type="checkbox" value="nataci√≥n"><span>nataci√≥n</span></label>
        <label class="chip"><input type="checkbox" value="astronom√≠a"><span>astronom√≠a</span></label>
        <label class="chip"><input type="checkbox" value="historia"><span>historia</span></label>
        <label class="chip"><input type="checkbox" value="poes√≠a"><span>poes√≠a</span></label>
        <label class="chip"><input type="checkbox" value="teatro"><span>teatro</span></label>
        <label class="chip"><input type="checkbox" value="idiomas"><span>idiomas</span></label>
        <label class="chip"><input type="checkbox" value="programaci√≥n"><span>programaci√≥n</span></label>
        <label class="chip"><input type="checkbox" value="pintura"><span>pintura</span></label>
        <label class="chip"><input type="checkbox" value="caf√©"><span>caf√©</span></label>
        <label class="chip"><input type="checkbox" value="helado"><span>helado</span></label>
        <label class="chip"><input type="checkbox" value="pan"><span>pan</span></label>
        <label class="chip"><input type="checkbox" value="pizza"><span>pizza</span></label>
        <label class="chip"><input type="checkbox" value="libros"><span>libros</span></label>
        <label class="chip"><input type="checkbox" value="electr√≥nica"><span>electr√≥nica</span></label>
        <label class="chip"><input type="checkbox" value="juguetes"><span>juguetes</span></label>
        <label class="chip"><input type="checkbox" value="comida"><span>comida</span></label>
        <label class="chip"><input type="checkbox" value="jugos"><span>jugos</span></label>
        <label class="chip"><input type="checkbox" value="kiosco"><span>kiosco</span></label>
      </div>
  <div class="limitNote" style="color:#b6b0ff">Seleccionados: <span id="likesCount">0</span>/5</div><div class="hint" style="color:#b6b0ff">Puedes pulsar ‚ÄúElegir 5 al azar‚Äù.</div>
    </div>
    <div class="col-12" style="display:flex;gap:10px;flex-wrap:wrap">
      <button id="btnRandLikes" type="button" class="btn">Elegir 5 al azar</button>
      <button id="btnStart" type="button" class="btn primary">Comenzar</button>
      <span id="errBox" class="err">Falta el nombre o no elegiste exactamente 5 gustos.</span>
    </div>

<!-- (Removido) Modal para mejorar contrase√±a -->
  </form>
</div>


<!-- Botonera se integrar√° dentro del UI dock -->

<canvas id="world"></canvas>

<button id="uiShowBtn" title="Mostrar panel" aria-label="Mostrar panel"></button>
<!-- Bot√≥n flotante para seguir al agente (sin texto, s√≥lo icono) -->
<button id="followFab" class="fab" title="Seguir a mi agente" aria-label="Seguir agente"></button>
<div id="uiDock">
  <div class="card">
    <b>Mundo activo</b><br/><small>Trabajo 60s = +15 ‚Üí üí∞ banco</small>
    <div style="display:flex;gap:10px;align-items:center;margin-top:6px">
  <img id="uiAvatar" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='128' height='128'><rect width='100%' height='100%' fill='white'/><text x='50%' y='52%' text-anchor='middle' dominant-baseline='middle' font-size='84' font-family='Segoe UI, Arial, sans-serif' fill='%239ca3af'>?</text></svg>" style="width:56px;height:56px;border-radius:8px;border:1px solid #2b3553;background:#fff;object-fit:cover" alt="avatar" />
      <div>
        <div id="stats" style="font-size:12px"></div>
        <div id="userName" style="font-size:12px;opacity:.9;margin-top:2px">Sin iniciar</div>
      </div>
    </div>
    <div class="actions" style="margin-top:8px">
      <button id="btnHouse" class="btn good">Comprar Casa</button>
      <button id="btnShop" class="btn">Comprar Negocio</button>
  <button id="btnShowAgentDoc" class="btn" title="Documento del Agente">üìÑ Documento</button>
  <button id="btnLogout" class="btn bad" title="Cerrar sesi√≥n">GUARDAR Y SALIR</button>
    </div>
  <div id="ownedShops" class="hint" style="margin-top:6px">Negocios: 0</div>
  </div>

  <!-- Bloque compacto de utilidades: Documento / Casados / Gobierno / Seguir -->
  <div class="card">
    <div class="actions">
  <button id="btnShowGovDoc" class="btn">ÔøΩ Doc. Gobierno</button>
      <button id="btnShowMarried" class="btn">üë®‚Äçüë©üëß‚Äçüë¶ Casados</button>
      <button id="btnGovOpen" class="btn">üèõÔ∏è Gobierno</button>
    </div>
  </div>

  <div class="card">
    <h4 style="margin:0 0 4px 0">Concesionario</h4>
    <div class="field">
      <select id="carTypeSelect" class="select">
        <option value="">-- Elige un veh√≠culo --</option>
        <option value="bicicleta">Bicicleta (50)</option>
        <option value="moto">Motocicleta (200)</option>
        <option value="auto_compacto">Auto Compacto (800)</option>
        <option value="auto_deportivo">Auto Deportivo (2500)</option>
      </select>
    </div>
    <div class="actions" style="margin-top:6px"><button id="btnBuyCar" class="btn primary">Comprar veh√≠culo</button></div>
  <div id="carMsg" class="hint" style="margin-top:6px;color:#6b7280">Aumenta tu velocidad de movimiento.</div>
  </div>

  <div class="card" style="position:relative;">
    <h4 style="margin:0 0 4px 0">üí∞ Banco</h4>
  <pre id="bankBody" style="position:absolute; top:8px; right:56px; background:transparent; box-shadow:none; margin:0; padding:0; font-size:15px; color:var(--ok); text-align:right; min-width:80px;"></pre>
  </div>
  <!-- Bot√≥n para ocultar/mostrar el panel, ahora posicionado al fondo del dock -->
  <button id="uiHideBtn" title="Ocultar panel"></button>
</div>

<div id="docDock" style="display:none;">
  <div class="card" id="docCard">
    <h4 style="margin:0 0 6px 0">üìÑ Documento</h4>
    <pre id="docBody">Pulsa ‚ÄúDocumento‚Äù para generar el informe.</pre>
  </div>
</div>

<div id="marriedDock">
  <div class="card">
    <h4 style="margin:0 0 6px 0">üíç Familias</h4>
    <pre id="marriedList">No hay familias casadas todav√≠a.</pre>
  </div>
</div>

  <div id="govDock" style="display:none;">
  <div class="card">
    <div style="display:flex;align-items:center;justify-content:space-between">
      <h4 style="margin:0 0 6px 0">üèõÔ∏è Panel de Gobierno</h4>
  <button id="btnGovClose" title="Cerrar">‚úï</button>
    </div>
    <div id="govDesc" class="hint" style="margin-bottom:6px"></div>
    <div id="govFunds" class="hint" style="margin:6px 0">Fondo: 0</div>

    <h4>Instituciones (25 tipos)</h4>
    <div class="field">
      <label>Selecciona instituci√≥n</label>
      <select id="govSelect" class="select"></select>
    </div>
    <div class="actions" style="margin-top:8px">
      <button id="btnGovPlace" class="btn primary">Colocar instituci√≥n</button>
    </div>
    <div class="hint" id="govHint" style="margin-top:6px">Elige y luego haz clic en el mapa.</div>
  </div>
</div>

<!-- Controles de zoom removidos por solicitud del usuario -->

<div id="mini">
  <canvas id="miniCanvas" width="200" height="130"></canvas>
  <div class="hint">Toca para mover</div>
</div>

<!-- Bot√≥n Seguir: solo el flotante en el mapa -->

<div id="builderModal">
  <div class="modalBox">
    <h3>üèóÔ∏è Comprar Casa Propia</h3>
    <p style="margin-top:0">Las casas propias se pueden construir en cualquier espacio libre de la zona urbana que no cruce calles o edificios.</p>
    <div class="actions" style="margin-top:8px">
      <button id="btnBuy" class="btn good">Comprar (3000)</button>
      <button id="btnBuilderClose" class="btn">Cerrar</button>
    </div>
    <div id="builderMsg" class="hint" style="margin-top:8px"></div>
  </div>
</div>

<div id="shopModal">
  <div class="modalBox">
    <h3>üè™ Comprar Negocio</h3>
    <p style="margin-top:0">Paga y luego col√≥calo en el mapa. No se permiten cruces con calles.</p>
    <div id="shopList"></div>
    <div class="hint" id="shopMsg" style="margin-top:8px"></div>
    <div class="actions" style="margin-top:8px"><button id="btnShopClose" class="btn">Cerrar</button></div>
  </div>
</div>

<!-- Documento (modal emergente) -->
<div id="docModal" style="display:none;position:fixed;inset:0;z-index:50;background:rgba(0,0,0,.35);align-items:center;justify-content:center;padding:5vh 10px;">
  <div class="modalBox" style="width:min(700px,94vw); max-height:80vh; overflow:auto;">
    <div style="display:flex;align-items:center;justify-content:space-between">
  <h4 id="docTitle" style="margin:0 0 6px 0">üìÑ Documento</h4>
      <button id="btnDocClose" title="Cerrar">‚úï</button>
    </div>
    <div id="docBodyModal" style="font-size:18px; line-height:1.4;">
      Pulsa ‚ÄúDocumento‚Äù para generar el informe.
    </div>
  </div>
  
</div>

<!-- Casados (modal emergente) -->
<div id="marriedModal" style="display:none;position:fixed;inset:0;z-index:50;background:rgba(0,0,0,.35);align-items:center;justify-content:center;padding:5vh 10px;">
  <div class="modalBox" style="width:min(700px,94vw); max-height:80vh; overflow:auto;">
    <div style="display:flex;align-items:center;justify-content:space-between">
      <h4 style="margin:0 0 6px 0">üíç Familias</h4>
      <button id="btnMarriedClose" title="Cerrar">‚úï</button>
    </div>
    <pre id="marriedListModal" style="font-size:20px; line-height:1.5; white-space:pre-wrap;">No hay familias casadas todav√≠a.</pre>
  </div>
  
</div>

<div id="modal">
  <div class="modalBox">
    <h3 id="modalTitle">Nombre del beb√©</h3>
    <div class="actions"><button id="btnBabyOk" class="btn">OK</button></div>
  </div>
</div>

<div id="toast"></div>

<!-- Multijugador: socket.io cliente y wrapper -->
<script>
// Intenta cargar Socket.IO desde el servidor; si falla, usa CDN
(function(){
  var s = document.createElement('script');
  s.src = '/socket.io/socket.io.js';
  s.defer = true;
  s.onerror = function(){
    var cdn = document.createElement('script');
    cdn.src = 'https://cdn.socket.io/4.7.5/socket.io.min.js';
    cdn.crossOrigin = 'anonymous';
    cdn.referrerPolicy = 'no-referrer';
    cdn.defer = true;
    document.head.appendChild(cdn);
  };
  document.head.appendChild(s);
})();
</script>
<script src="js/socket.js" defer></script>
<!-- Autenticaci√≥n usuario/registro -->
<script src="js/user-auth.js" defer></script>
<!-- L√≥gica del mundo (usa el estado compartido si est√° disponible) -->
<script src="js/original.js" defer></script>
<script>
// Sin reposicionamiento din√°mico: el bot√≥n queda fijo en la parte inferior centrada
</script>
</body>
</html>