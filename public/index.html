<!DOCTYPE html> 
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>Mundo urbano — Gobierno Central y Nuevos Edificios (Multiplayer)</title>
<link rel="stylesheet" href="/css/public_css_estilos.css">
<style>
  @import "otra.css";
  :root { --color-principal: yellow; }
  body { background: var(--color-principal); }

  :root{
    /* Tema amarillo (variables ajustadas) */
    --bg:#ffd54f; /* fondo principal */
    --card:#fff8e1; /* tarjetas y modales */
    /* UI más oscuro, azul-grisáceo con transparencia */
    --ui:#9aa7b3cc; /* elementos UI con transparencia (darker bluish-gray) */
    --edge:#d4a300; /* bordes/acento oscuro */
    --brand:#ff9800; /* color principal de botones */
    --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444; --muted:#8b6b00; --text:#222222;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#fff8e1);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Arial;overflow:hidden}
  html, body {touch-action: none; -webkit-user-select: none; -ms-user-select: none; user-select: none;}
  *{box-sizing:border-box}


  #formBar{position:fixed;top:0;left:0;right:0;z-index:2000;background:rgba(15,28,48,0.85);border-bottom:1px solid rgba(20,40,64,0.28);backdrop-filter:blur(6px);color:#eef7fb}
  #formInner{width:min(1100px,98vw);margin:0 auto;padding:12px;display:grid;grid-template-columns:repeat(12,1fr);gap:10px}
  #formInner h2{grid-column:1/-1;margin:0 0 4px 0;color:var(--brand);font-size:18px}
  .field{display:flex;flex-direction:column;gap:6px}
  .field label{font-size:12px;opacity:.95}
  .input,.select{padding:10px 12px;border:1px solid rgba(0,0,0,0.06);border-radius:10px;background:var(--card);color:var(--text);min-height:38px}
  .btn{all:unset;cursor:pointer;padding:10px 12px;border:1px solid rgba(0,0,0,0.06);border-radius:12px;background:var(--brand);color:var(--text);font-weight:700;text-align:center}
  .btn.primary{border-color:var(--edge);background:var(--brand);color:var(--text)}
  .btn.good{border-color:#1e7a3a;background:#34d399;color:#042021}
  .hint{font-size:12px;opacity:.8}
  .err{color:#fecaca;font-size:12px;display:none}
  .col-3{grid-column:span 3}.col-4{grid-column:span 4}.col-6{grid-column:span 6}.col-12{grid-column:span 12}
  @media (max-width:960px){.col-3,.col-4,.col-6{grid-column:1/-1}}


  #likesWrap{display:grid;grid-template-columns:repeat(4,minmax(150px,1fr));gap:8px;max-height:240px;overflow:auto;padding:8px;border:1px dashed rgba(0,0,0,0.08);border-radius:12px;background:rgba(24,36,48,0.5);}
  @media (max-width:960px){#likesWrap{grid-template-columns:repeat(2,minmax(150px,1fr));max-height:280px}}
  .chip{display:flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid rgba(255,255,255,0.06);border-radius:999px;background:rgba(255,255,255,0.04);font-size:13px;white-space:nowrap;color:#eef7fb}
  .chip input{accent-color:#60a5fa;width:18px;height:18px}
  .chip.disabled{opacity:.45;filter:grayscale(40%)}
  .chip.disabled input{pointer-events:none}
  .limitNote{font-size:12px;margin-top:4px;color:#93c5fd}

  /* Avatar grid for visual selection */
  #avatarGrid{display:flex;gap:8px;align-items:center}
  .avatar-option{width:48px;height:48px;padding:0;border-radius:8px;border:1px solid transparent;background:transparent;display:inline-grid;place-items:center;cursor:pointer}
  .avatar-option img{width:100%;height:100%;object-fit:cover;border-radius:8px;display:block}
  .avatar-option.selected{outline:2px solid rgba(100,160,220,0.85);box-shadow:0 4px 14px rgba(16,24,32,0.45)}


  /* Mostrar canvas principal por defecto (antes estaba oculto) */
  #world{display:block;width:100vw;height:100vh;position:fixed;inset:0;z-index:10}
  .card{background:var(--card);border:1px solid rgba(0,0,0,0.06);border-radius:12px;padding:10px 12px;backdrop-filter:blur(4px);position:relative}
  /* UI menus shown inside the map: darker bluish with more transparency for subtle overlay */
  #uiDock .card, #docDock .card, #govDock .card {
    background: rgba(12,18,26,0.78); /* stronger, darker bluish-gray at 78% opacity */
    border-color: rgba(5,10,18,0.24);
    color: #f3f8fb; /* light text for contrast */
    backdrop-filter: blur(6px);
  }
  #uiDock, #docDock, #govDock{position:fixed;top:10px;z-index:24;display:none;width:min(340px,92vw);display:flex;flex-direction:column;gap:10px;pointer-events:auto}
  #uiDock{left:10px;}
  /* Transition para mostrar/ocultar con animación (hacia la izquierda) */
  #uiDock{transition: transform 260ms ease, opacity 220ms ease; will-change: transform, opacity}
  .collapsed-left{transform: translateX(-120%); opacity: 0; pointer-events: none}
  #docDock{left:10px;}
  #marriedDock{position:fixed; top:10px; left:10px; z-index:24; width:min(340px,92vw); display:none; flex-direction:column; gap:10px; pointer-events:auto;}
  #govDock{left:10px;}
  /* Posicionar el botón de ocultar UI en la parte inferior del panel */
  #uiHideBtn{position:absolute;right:8px;bottom:8px;top:auto;width:34px;height:34px;border-radius:999px;border:1px solid rgba(0,0,0,0.08);background:var(--ui);color:var(--text);display:grid;place-items:center;cursor:pointer;box-shadow:0 6px 20px rgba(0,0,0,.06);font-size:18px;line-height:0}
  #uiShowBtn{position:fixed;left:12px;top:10px;z-index:25;width:38px;height:38px;border-radius:999px;border:1px solid rgba(0,0,0,0.08);background:var(--ui);color:var(--text);cursor:pointer;box-shadow:0 4px 20px rgba(0,0,0,.04);text-align:center;padding:0;display:none;display:grid;place-items:center}
  /* Triángulo centrado ópticamente dentro del círculo */
  #uiShowBtn::before{
    content:"";
    width:0;height:0;
    border-left:7px solid transparent;
    border-right:7px solid transparent;
    border-top:11px solid currentColor;
    transform: translateX(5px);
  }


  .actions{display:flex;gap:8px;flex-wrap:wrap}
  pre{white-space:pre-wrap;font-family:ui-monospace,monospace;font-size:7px;max-height:40vh;overflow:auto;margin:0}


  #zoomFab{position:fixed;right:12px;bottom:12px;z-index:26;display:flex;flex-direction:column;gap:10px;pointer-events:auto}
  .fab{width:56px;height:56px;border-radius:50%;display:grid;place-items:center;background:var(--brand);border:1px solid rgba(0,0,0,0.06);box-shadow:0 8px 20px rgba(0,0,0,.06);font-size:22px;cursor:pointer;user-select:none;color:var(--text)}
  .fab:active{transform:scale(.96)}
  
  #modal,#builderModal,#shopModal{position:fixed;inset:0;z-index:50;background:rgba(0,0,0,.35);display:none;align-items: flex-start;justify-content:center;padding-top: 5vh;}
  .modalBox{width:min(560px,94vw);background:var(--card);border:1px solid rgba(0,0,0,0.06);border-radius:14px;padding:14px}
  .modalBox h3{margin:0 0 8px 0}
  .modalBox h4{margin:8px 0 6px 0}


  .balance-amount { color: var(--ok); font-size: 1.2em; font-weight: bold; }
  /* Botonera (Documento/Casados) a la izquierda, debajo del UI, también colapsable a la izquierda */
  #top-bar{position:fixed;left:10px;top:10px;z-index:24;display:none;gap:10px;transition: transform 260ms ease, opacity 220ms ease; will-change: transform, opacity}
  #top-bar button{all:unset;cursor:pointer;padding:8px 16px;border-radius:12px;background:var(--ui);border:1px solid var(--edge);font-weight:700;box-shadow:0 4px 20px rgba(0,0,0,.4);}


  #shopList{display:grid;grid-template-columns:1fr;gap:8px;max-height:260px;overflow-y:auto;padding:8px;border:1px solid rgba(0,0,0,0.06);border-radius:10px;background:var(--card)}


  #mini{position:fixed;right:12px;top:12px;z-index:26;display:block;width:200px;height:130px;border:1px solid rgba(0,0,0,0.06);border-radius:10px;background:var(--card);box-shadow:0 6px 22px rgba(0,0,0,.04);cursor:crosshair;pointer-events:auto}
  #mini canvas{width:100%;height:100%;display:block}
  #mini .hint{position:absolute;left:6px;bottom:4px;font-size:10px;opacity:.7}


  #toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;z-index:40;display:none;background:rgba(255,245,157,0.9);border:1px solid rgba(0,0,0,0.06);color:var(--text);padding:8px 12px;border-radius:10px;font-size:13px}
  /* Botones de salida/cerrar en rojo */
  #btnLogout{background:var(--bad) !important;color:#fff !important;border-color:#b91c1c !important}
  #btnLogout:hover{filter:brightness(1.05)}
  #btnLogout:active{transform:scale(.98)}
  #btnGovClose{all:unset;cursor:pointer;display:grid;place-items:center;width:30px;height:30px;border-radius:8px;background:var(--bad);color:#fff;font-weight:800;line-height:1;box-shadow:0 2px 8px rgba(0,0,0,.25)}
  #btnGovClose:hover{filter:brightness(1.05)}
  #btnGovClose:active{transform:scale(.96)}
</style>
<style>
  /* Aumentar tamaño de letra para Documento y Casados */
  #docBody, #marriedList { font-size: 22px !important; line-height: 1.5; }
</style>
</head> 
<body>

<div id="formBar" role="dialog" aria-modal="true" style="display:none">
  <form id="formInner" autocomplete="off">
    <h2>Crear tu persona (24h = 1 año · fallece a los 90)</h2>
    <div class="field col-3">
      <!-- Gender select removed: avatars are selectable only. Keep hidden field to avoid JS errors. -->
      <input type="hidden" id="fGender" value="U" />
      <div id="avatarGrid" style="margin-top:8px">
  <button type="button" class="avatar-option" data-src="/assets/avatar1.png"><img src="/assets/avatar1.png" alt="H1"/></button>
  <button type="button" class="avatar-option" data-src="/assets/avatar2.png"><img src="/assets/avatar2.png" alt="H2"/></button>
  <button type="button" class="avatar-option" data-src="/assets/avatar3.png"><img src="/assets/avatar3.png" alt="F1"/></button>
  <button type="button" class="avatar-option" data-src="/assets/avatar4.png"><img src="/assets/avatar4.png" alt="F2"/></button>
      </div>
      <div style="margin-top:8px;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <input id="avatarFile" type="file" accept="image/*" style="display:none" />
  <button id="btnUploadAvatar" type="button" class="btn">Subir foto</button>
  <button id="btnRemoveAvatar" type="button" class="btn">Quitar foto</button>
  <img id="fGenderPreview" src="/assets/avatar1.png" alt="Vista previa" style="width:48px;height:48px;border-radius:50%;border:1px solid #2b3553;background:#fff;object-fit:cover" />
        <span class="hint">Puedes subir una foto para usarla como avatar. Se mostrará en el panel y en tu agente.</span>
      </div>
    </div>
  <div class="field col-3"><label>Nombre</label><input id="fName" type="text" maxlength="12" class="input" placeholder="nombre de usuario"/></div>
    <div class="field col-3"><label>Edad</label><input id="fAge" type="number" min="0" max="120" value="20" class="input"/></div>
  <div class="field col-3"><label>Créditos iniciales</label><input id="fUsd" type="number" min="0" max="0" step="1" value="0" class="input" disabled/><div class="hint">Todos comienzan con 400 créditos gratis.</div></div>
    <div class="field col-12">
      <label>Elige exactamente 5 gustos</label>
      <div id="likesWrap" aria-label="Lista de gustos">
        <label class="chip"><input type="checkbox" value="música"><span>música</span></label>
        <label class="chip"><input type="checkbox" value="arte"><span>arte</span></label>
        <label class="chip"><input type="checkbox" value="deporte"><span>deporte</span></label>
        <label class="chip"><input type="checkbox" value="naturaleza"><span>naturaleza</span></label>
        <label class="chip"><input type="checkbox" value="lectura"><span>lectura</span></label>
        <label class="chip"><input type="checkbox" value="cocina"><span>cocina</span></label>
        <label class="chip"><input type="checkbox" value="baile"><span>baile</span></label>
        <label class="chip"><input type="checkbox" value="tecnología"><span>tecnología</span></label>
        <label class="chip"><input type="checkbox" value="cine"><span>cine</span></label>
        <label class="chip"><input type="checkbox" value="viajes"><span>viajes</span></label>
        <label class="chip"><input type="checkbox" value="jardinería"><span>jardinería</span></label>
        <label class="chip"><input type="checkbox" value="fotografía"><span>fotografía</span></label>
        <label class="chip"><input type="checkbox" value="animales"><span>animales</span></label>
        <label class="chip"><input type="checkbox" value="playa"><span>playa</span></label>
        <label class="chip"><input type="checkbox" value="montaña"><span>montaña</span></label>
        <label class="chip"><input type="checkbox" value="videojuegos"><span>videojuegos</span></label>
        <label class="chip"><input type="checkbox" value="yoga"><span>yoga</span></label>
        <label class="chip"><input type="checkbox" value="meditación"><span>meditación</span></label>
        <label class="chip"><input type="checkbox" value="correr"><span>correr</span></label>
        <label class="chip"><input type="checkbox" value="ciclismo"><span>ciclismo</span></label>
        <label class="chip"><input type="checkbox" value="fútbol"><span>fútbol</span></label>
        <label class="chip"><input type="checkbox" value="baloncesto"><span>baloncesto</span></label>
        <label class="chip"><input type="checkbox" value="natación"><span>natación</span></label>
        <label class="chip"><input type="checkbox" value="astronomía"><span>astronomía</span></label>
        <label class="chip"><input type="checkbox" value="historia"><span>historia</span></label>
        <label class="chip"><input type="checkbox" value="poesía"><span>poesía</span></label>
        <label class="chip"><input type="checkbox" value="teatro"><span>teatro</span></label>
        <label class="chip"><input type="checkbox" value="idiomas"><span>idiomas</span></label>
        <label class="chip"><input type="checkbox" value="programación"><span>programación</span></label>
        <label class="chip"><input type="checkbox" value="pintura"><span>pintura</span></label>
        <label class="chip"><input type="checkbox" value="café"><span>café</span></label>
        <label class="chip"><input type="checkbox" value="helado"><span>helado</span></label>
        <label class="chip"><input type="checkbox" value="pan"><span>pan</span></label>
        <label class="chip"><input type="checkbox" value="pizza"><span>pizza</span></label>
        <label class="chip"><input type="checkbox" value="libros"><span>libros</span></label>
        <label class="chip"><input type="checkbox" value="electrónica"><span>electrónica</span></label>
        <label class="chip"><input type="checkbox" value="juguetes"><span>juguetes</span></label>
        <label class="chip"><input type="checkbox" value="comida"><span>comida</span></label>
        <label class="chip"><input type="checkbox" value="jugos"><span>jugos</span></label>
        <label class="chip"><input type="checkbox" value="kiosco"><span>kiosco</span></label>
      </div>
      <div class="limitNote">Seleccionados: <span id="likesCount">0</span>/5</div><div class="hint">Puedes pulsar “Elegir 5 al azar”.</div>
    </div>
    <div class="col-12" style="display:flex;gap:10px;flex-wrap:wrap">
      <button id="btnRandLikes" type="button" class="btn">Elegir 5 al azar</button>
      <button id="btnStart" type="button" class="btn primary">Comenzar</button>
      <button id="btnImprovePwd" type="button" class="btn good">Mejorar tu contraseña</button>
      <span id="errBox" class="err">Falta el nombre o no elegiste exactamente 5 gustos.</span>
    </div>

<!-- Modal para mejorar contraseña -->
<div id="pwdModal" style="display:none;position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,0.35);align-items:center;justify-content:center;">
  <div style="background:var(--card);border-radius:14px;padding:24px;max-width:370px;margin:auto;box-shadow:0 8px 32px rgba(0,0,0,0.18);text-align:left;">
    <h3 style="margin-top:0">Agrega una contraseña más segura</h3>
    <div style="font-size:16px;margin-bottom:12px;color:#d97706;font-weight:500;">Recomendación: Usa una contraseña con mínimo 8 caracteres, combinando mayúsculas, minúsculas, números y símbolos. Ejemplo: <span style="color:#2563eb;font-weight:600;">Mundo!2025@urbano</span></div>
    <input id="newPwdInput" type="password" placeholder="Nueva contraseña" style="width:100%;padding:10px 12px;border-radius:8px;border:1px solid #d4a300;font-size:18px;margin-bottom:12px;" />
    <button id="btnSaveNewPwd" class="btn good" style="width:100%;font-size:18px;">Guardar nueva contraseña</button>
    <div id="pwdMsg" style="margin-top:10px;font-size:15px;color:#22c55e;display:none;"></div>
    <button id="btnClosePwdModal" class="btn" style="margin-top:18px;">Cerrar</button>
  </div>
</div>
  </form>
</div>


<div id="top-bar">
  <button id="btnShowDoc">📄 Documento</button>
  <button id="btnShowMarried">👨‍👩👧‍👦 Casados</button>
</div>

<canvas id="world"></canvas>

<button id="uiShowBtn" title="Mostrar panel" aria-label="Mostrar panel"></button>
<div id="uiDock">
  <div class="card">
    <b>Mundo activo</b><br/><small>Trabajo 60s = +15 → 💰 banco</small>
    <div style="display:flex;gap:10px;align-items:center;margin-top:6px">
  <img id="uiAvatar" src="/assets/avatar1.png" style="width:56px;height:56px;border-radius:8px;border:1px solid #2b3553;background:#fff;object-fit:cover" alt="avatar" />
      <div>
        <div id="stats" style="font-size:12px"></div>
        <div id="userName" style="font-size:12px;opacity:.9;margin-top:2px">Sin iniciar</div>
      </div>
    </div>
    <div class="actions" style="margin-top:8px">
      <button id="toggleLines" class="btn">Líneas ON/OFF</button>
      <button id="btnHouse" class="btn good">Comprar Casa</button>
      <button id="btnShop" class="btn">Comprar Negocio</button>
  <button id="btnLogout" class="btn" title="Cerrar sesión">SALIR</button>
    </div>
  <div id="ownedShops" class="hint" style="margin-top:6px">Negocios: 0</div>
  </div>

  <div class="card">
    <h4 style="margin:0 0 6px 0">Concesionario</h4>
    <div class="field">
      <select id="carTypeSelect" class="select">
        <option value="">-- Elige un vehículo --</option>
        <option value="bicicleta">Bicicleta (50)</option>
        <option value="moto">Motocicleta (200)</option>
        <option value="auto_compacto">Auto Compacto (800)</option>
        <option value="auto_deportivo">Auto Deportivo (2500)</option>
      </select>
    </div>
    <div class="actions" style="margin-top:8px"><button id="btnBuyCar" class="btn primary">Comprar vehículo</button></div>
    <div id="carMsg" class="hint" style="margin-top:8px">Aumenta tu velocidad de movimiento.</div>
  </div>

  <div class="card" style="position:relative;">
    <h4 style="margin:0 0 6px 0">💰 Banco</h4>
    <div class="actions" style="margin-bottom:6px"><button id="panelDepositAll" class="btn">Depositar todo</button></div>
    <pre id="bankBody" style="position:absolute; top:10px; right:16px; background:transparent; box-shadow:none; margin:0; padding:0; font-size:15px; color:var(--ok); text-align:right; min-width:80px;"></pre>
  </div>
  <!-- Botón para ocultar/mostrar el panel, ahora posicionado al fondo del dock -->
  <button id="uiHideBtn" title="Ocultar panel">▲</button>
</div>

<div id="docDock" style="display:none;">
  <div class="card" id="docCard">
    <h4 style="margin:0 0 6px 0">📄 Documento</h4>
    <pre id="docBody">Pulsa “Documento” para generar el informe.</pre>
  </div>
</div>

<div id="marriedDock">
  <div class="card">
    <h4 style="margin:0 0 6px 0">💍 Familias</h4>
    <pre id="marriedList">No hay familias casadas todavía.</pre>
  </div>
</div>

  <div id="govDock" style="display:none;">
  <div class="card">
    <div style="display:flex;align-items:center;justify-content:space-between">
      <h4 style="margin:0 0 6px 0">🏛️ Panel de Gobierno</h4>
  <button id="btnGovClose" title="Cerrar">✕</button>
    </div>
    <div id="govDesc" class="hint" style="margin-bottom:6px"></div>
    <div id="govFunds" class="hint" style="margin:6px 0">Fondo: 0</div>

    <h4>Instituciones (25 tipos)</h4>
    <div class="field">
      <label>Selecciona institución</label>
      <select id="govSelect" class="select"></select>
    </div>
    <div class="actions" style="margin-top:8px">
      <button id="btnGovPlace" class="btn primary">Colocar institución</button>
    </div>
    <div class="hint" id="govHint" style="margin-top:6px">Elige y luego haz clic en el mapa.</div>
  </div>
</div>

<div id="zoomFab" aria-label="Controles de zoom">
  <div id="zoomIn" class="fab" title="Acercar">＋</div>
  <div id="zoomOut" class="fab" title="Alejar">−</div>
</div>

<div id="mini">
  <canvas id="miniCanvas" width="200" height="130"></canvas>
  <div class="hint">Toca para mover</div>
</div>

<div id="builderModal">
  <div class="modalBox">
    <h3>🏗️ Comprar Casa Propia</h3>
    <p style="margin-top:0">Las casas propias se pueden construir en cualquier espacio libre de la zona urbana que no cruce calles o edificios.</p>
    <div class="actions" style="margin-top:8px">
      <button id="btnBuy" class="btn good">Comprar (3000)</button>
      <button id="btnBuilderClose" class="btn">Cerrar</button>
    </div>
    <div id="builderMsg" class="hint" style="margin-top:8px"></div>
  </div>
</div>

<div id="shopModal">
  <div class="modalBox">
    <h3>🏪 Comprar Negocio</h3>
    <p style="margin-top:0">Paga y luego colócalo en el mapa. No se permiten cruces con calles.</p>
    <div id="shopList"></div>
    <div class="hint" id="shopMsg" style="margin-top:8px"></div>
    <div class="actions" style="margin-top:8px"><button id="btnShopClose" class="btn">Cerrar</button></div>
  </div>
</div>

<div id="modal">
  <div class="modalBox">
    <h3 id="modalTitle">Nombre del bebé</h3>
    <div class="actions"><button id="btnBabyOk" class="btn">OK</button></div>
  </div>
</div>

<div id="toast"></div>

<!-- Multijugador: socket.io cliente y wrapper -->
<script src="/socket.io/socket.io.js"></script>
<script src="/js/socket.js"></script>
<!-- Autenticación usuario/registro -->
<script src="/js/user-auth.js"></script>
<!-- Lógica del mundo (usa el estado compartido si está disponible) -->
<script src="/js/original.js"></script>
</body>
</html>